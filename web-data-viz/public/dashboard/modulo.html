<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Teoria Musical - M칩dulo Din칙mico</title>

    <script src="../js/sessao.js"></script>
    <script src="../js/alerta.js"></script>


    <link rel="icon" href="../assets/Teoria_em_Compasso-Logo.ico" type="image/x-icon" />
    <link rel="stylesheet" href="../css/modulo.css" />

</head>

<body onload="validarSessao(), carregarModulo()">
    <nav>
        <div class="cont_pai_nav">

            <div id="home" class="cont_filho_nav_cima"> <!--LOGO, CIMA-->
                <img src="../assets/Teoria_em_Compasso-Logo.png" alt="Logo">
            </div>

            <div class="cont_filho_nav_user">
                Ol치, <span id="b_usuario">a</span>
            </div>

            <div class="cont_filho_nav_centro"> <!--MEIO-->

                <a href="home.html"> Home </a>

                <a href="atividade.html"> Atividade </a>

                <a href="perfil.html"> Perfil </a>

            </div>

            <div class="cont_filho_nav_baixo"> <!--BAIXO-->
                <a onclick="limparSessao()"> Sair</a>
            </div>

        </div>
    </nav>

    <header>
        <h1 id="titulo-modulo">Carregando...</h1>
    </header>

    <main>
        <div class="container" id="container-conteudo">
            <!-- Conte칰do do m칩dulo ser치 inserido aqui -->
        </div>

        <button id="btn-quiz" style="display:none;">
            Ir para Quiz deste M칩dulo 游꿢
        </button>
    </main>

    <footer>
        &copy; 2025 Teoria Musical Online 游꿮
    </footer>

    <script>
        async function carregarModulo() {
            const idModulo = sessionStorage.getItem("moduloSelecionado");

            if (!idModulo) {
                document.getElementById('container-conteudo').innerText = 'M칩dulo n칚o especificado.';
                document.getElementById('titulo-modulo').innerText = 'Erro';
                return;
            }

            try {
                const resposta = await fetch(`http://localhost:3333/modulos/${idModulo}`);

                if (!resposta.ok) {
                    throw new Error(`Erro ao buscar m칩dulo: ${resposta.status}`);
                }

                const dados = await resposta.json();
                console.log("DADOS RECEBIDOS:", dados);

                if (!dados) {
                    throw new Error('Dados do m칩dulo n칚o encontrados.');
                }

                document.getElementById('titulo-modulo').innerText = dados.titulo;

                let html = `
            <div class="intro">
                <h2>Descri칞칚o do M칩dulo</h2>
                <p>${dados.descricao}</p>
            </div>
        `;

                // Se houver conte칰dos vinculados
                if (dados.conteudos && dados.conteudos.length > 0) {
                    html += `
                <h2>Conte칰dos</h2>
                <div class="conteudos">
            `;

                    dados.conteudos.forEach(item => {
                        html += `
                    <div class="card">
                        <h3>${item.titulo}</h3>
                        <p>${item.descricao}</p>
                    </div>
                `;
                    });

                    html += `</div>`;
                }

                document.getElementById('container-conteudo').innerHTML = html;

                // Mostrar bot칚o para quiz se houver quiz
                const btnQuiz = document.getElementById('btn-quiz');
                if (dados.quiz) {
                    btnQuiz.style.display = 'inline-block';
                    btnQuiz.onclick = () => {
                        window.location.href = `quiz.html?id=${idModulo}`;
                    };
                } else {
                    btnQuiz.style.display = 'none';
                }

            } catch (error) {
                console.error(error);
                document.getElementById('container-conteudo').innerText = `Erro: ${error.message}`;
                document.getElementById('titulo-modulo').innerText = 'Erro ao carregar m칩dulo';
            }
        }

        window.onload = carregarModulo;

    </script>
</body>

</html>